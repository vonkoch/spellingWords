<!DOCTYPE html>
<html>
<body>
<style>
  html { font-family: sans-serif; }
  html, button, input { font-size: 16px; }
  input.false { color: red; text-transform: capitalize; }
  input.correct { background-color: green; color: white; text-transform: capitalize; }
  td.word { visibility: hidden; text-align: right; text-transform: capitalize; }
</style>
<script>
    async function getWords() {
        const requestURL = 'words.json';
        const request = new Request(requestURL);

        const response = await fetch(request);
        const words = await response.json();
        return words;
    }

    function say(words) {
      var msg = new SpeechSynthesisUtterance(words);
      msg.rate = 0.8;
      window.speechSynthesis.speak(msg);
    }

    const CSVToJSON = (data, delimiter = ',') => {
        const titles = data.slice(0, data.indexOf('\n')).split(delimiter);
        return data
            .slice(data.indexOf('\n') + 1)
            .split('\n')
            .map(v => {
            const values = v.split(delimiter);
            return titles.reduce(
                (obj, title, index) => ((obj[title] = values[index]), obj),
                {}
            );
            });
        };

    const avkWordsUnit25 = CSVToJSON(`word,description
director,The play has a great director.
pitcher,The pitcher threw a fastball.
commander,They saluted their commander.
colonist,A colonist settled in Jamestown.
typist,Are you a fast typist?
scientist,The scientist studied sea life.
editor,An editor corrects errors in writing.
homemaker,A homemaker manages the home.
operator,The machine needs one operator.
professor,My neighbor is a college professor.
creditor,A creditor expects to be paid.
instructor,My piano instructor is talented.
artist,The sidewalk artist draws with chalk.
passenger,A passenger boards the bus.
inventor,Thomas Edison was an inventor.
tourist,The tourist visited a historic house.
cyclist,Every cyclist needs a helmet.
actor,The actor bowed and left the stage.
publisher,A publisher makes and sells books.
gardener,That gardener is fond of roses.`);

    const avkWordsUnit26 = CSVToJSON(`word,description
soldiers,Many soldiers defended the country.
pianos,These pianos need to be tuned.
essays,Sam enjoys essays about nature.
chiefs,Four fire chiefs got awards.
treaties,The treaties were signed in 1918.
countries,The two countries made peace.
luggage,Karla's luggage is green plaid.
skis,We should wax these skis.
characters,The story has two main characters.
badges,You can earn badges in the club.
valleys,The sheep graze in the valleys.
palaces,Most French palaces have fountains.
beliefs,Your beliefs may change someday.
gentlemen,These gentlemen have had dinner.
latches,Release the latches on that door.
envelopes,Put these letters into envelopes.
loaves,The round loaves are wheat bread.
groceries,We need groceries from the store.
heroes,Legends usually have brave heroes.
diaries,One day I may publish my diaries.`);

    const avkWordsUnit27 = [
      { "word": "bimonthly", "description": "I write a bimonthly bulletin." },
      { "word": "midday", "description": "By midday the bud had opened." },
      { "word": "semicircle", "description": "We sat in a semicircle." },
      { "word": "trisect", "description": "I will trisect the angle into parts." },
      { "word": "bicycle", "description": "Did you ride a bicycle to school?" },
      { "word": "midterm", "description": "The class had midterm exams." },
      { "word": "semifinal", "description": "Amir won the semifinal meet." },
      { "word": "midair", "description": "An eagle dived in midair." },
      { "word": "semiannual", "description": "It's a semiannual sale!" },
      { "word": "midafternoon", "description": "The rain came in midafternoon." },
      { "word": "semicolon", "description": "A semicolon connects sentences." },
      { "word": "bisect", "description": "To bisect the circle, draw a line." },
      { "word": "tricycle", "description": "The tricycle was his favorite gift." },
      { "word": "midnight", "description": "At midnight a new year begins." },
      { "word": "bifocals", "description": "She stared over her bifocals." },
      { "word": "semisweet", "description": "Taste this semisweet chocolate." },
      { "word": "triangle", "description": "The flag is folded into a triangle." },
      { "word": "biweekly", "description": "We have gym class biweekly." },
      { "word": "midland", "description": "The midland has no seashore." },
      { "word": "semiformal", "description": "It was a semiformal event." }
    ];
    
    const avkWordsUnit28 = [
      { "word": "generous", "description": "They made a generous donation." },
      { "word": "message", "description": "She left a message for us." },
      { "word": "stranger", "description": "A stranger walked into the cafÃ©." },
      { "word": "grudge", "description": "It's never good to hold a grudge." },
      { "word": "margin", "description": "Leave a margin of at least an inch." },
      { "word": "energy", "description": "Exercise gives you more energy." },
      { "word": "oxygen", "description": "We need to breathe nitrogen and oxygen." },
      { "word": "genius", "description": "Albert Einstein was a genius." },
      { "word": "college", "description": "We have a small college in our town." },
      { "word": "lodge", "description": "The lodge is halfway up the mountain." },
      { "word": "imagine", "description": "I like to imagine other worlds." },
      { "word": "stingy", "description": "Scrooge was known to be stingy." },
      { "word": "apology", "description": "The speaker made a public apology." },
      { "word": "gentleman", "description": "Above all, a gentleman must be kind." },
      { "word": "arrange", "description": "Can you arrange a special meeting?" },
      { "word": "pledge", "description": "The brothers made a pledge of loyalty." },
      { "word": "region", "description": "Water is scarce in that region." },
      { "word": "damage", "description": "There was little damage to the car." },
      { "word": "ledger", "description": "A bookkeeper keeps an accurate ledger." },
      { "word": "average", "description": "What is the average temperature?" }
    ];

    const avkWordsUnit29 = CSVToJSON(`word,description
vanity,Some movie stars display vanity.
humanity,A doctor can help humanity.
sickness,The baby's sickness lasted a week.
amusement,A playground provides amusement.
detective,A detective looks for evidence.
loyalty,Her loyalty is to her family.
majority,The majority of us wanted a party.
gentleness,Their gentleness is admirable.
argument,The argument is about politics.
humidity,This humidity curls my hair.
ability,Your singing ability is exceptional.
blindness,Some blindness begins at birth.
activity,An art activity would be fun.
relative,I have a relative who is famous.
employment,Rosa needs summer employment.
specialty,Cherry pie is their specialty.
creativity,With creativity, we can improve it.
arrangement,The flower arrangement goes here.
swiftness,The cheetah is known for swiftness.
tardiness,This note will explain my tardiness.`);

    const vvkwWordsBefore = [ "zoo", "tooth", "hook", "moon", "book", "soon", "took", "good", "room", "foot", "you", "who" ];

    const vvkWordsFri20230421 = [ "sky", "find", "night", "high", "fly", "try", "light", "dry", "right", "mind", "eye", "buy" ];

    function selectedKid() {
      const kid = document.querySelector('input[name="kid"]:checked').value;
      return kid;
    }

    function words() {
      return selectedKid() == "avk" ? 
        avkWordsUnit25.concat(avkWordsUnit26,avkWordsUnit27,avkWordsUnit28,avkWordsUnit29)
        // {...avkWordsUnit25,...avkWordsUnit26,...avkWordsUnit27,...avkWordsUnit28,...avkWordsUnit29} 
        : vvkWordsFri20230421;
    }

    function sayWord(btn) {
      event.cancelBubble = true;
      let row = btn.parentNode.parentNode;
      let word = row.querySelector("td.word").textContent;
      say(word);

      // let input = row.querySelector("input");
      // input.focus();
    }

    function sayDescription(btn) {
      let row = btn.parentNode.parentNode;
      let key = parseInt(row.querySelector("td.key").textContent) - 1;
      say(words()[key].description);

      // let input = row.querySelector("input");
      // input.focus();
    }

    function keypress(obj) {
      if (event.key === "Enter") {
        // Cancel the default action, if needed
        event.preventDefault();
        checkWord(obj);
      } else if (event.key === "1") {
        // Cancel the default action, if needed
        event.preventDefault();
        sayWord(obj);
      } else if (event.key === "2") {
        // Cancel the default action, if needed
        event.preventDefault();
        sayDescription(obj);
      }
    }

    function wordsEqual(word1, word2) {
      const w1 = word1.trim().toLowerCase();
      const w2 = word2.trim().toLowerCase();
      return ( w1 === w2);
    }

    function checkWord(obj) {
      const row = obj.parentNode.parentNode;
      const td = row.querySelector("td.word");
      const word = td.textContent;
      const input = row.querySelector("input");
      const val = input.value;

      if(val !== "") {
        input.className = wordsEqual(word,val) ? "correct" : "false";
        td.style.visibility = "visible";

        row.querySelectorAll('button, input').forEach(elem => {
          elem.disabled = true;
        });

        // set focus to next input
        // document.dispatchEvent(new KeyboardEvent('keydown', {'key': 'tab'}));
        const nextrow = row.nextSibling;
        if(nextrow) {
          const nextinput = nextrow.querySelector("input");
          nextinput.focus();
        }
      } else {
        input.focus();
      }
    }

    function tryAgain() {
      // re-enable all inputs
      const table = document.querySelector('tbody')
      table.querySelectorAll('button, input').forEach(elem => {
          elem.disabled = false;
        });

      // hide the words
      table.querySelectorAll('td.word').forEach(elem => {
        elem.style.visibility = "hidden";
      });
    }

    function toggleKid() {
      // remove all the table content
      const table = document.querySelector('tbody');
      table.innerHTML = "";

      // build the prompts again
      setTimeout(() => {
        buildPrompts();
      }, "300");
    }

function buildPrompts() {
      const table = document.querySelector('tbody');

      const wordlist = words();
      for(i in wordlist) {
        let row = `<tr><td class="key">${parseInt(i)+1}</td>
          <td><button onClick="sayWord(this); return false;">Word</button></td>
          <td ${(typeof wordlist[i] === 'string') ? 'style="display:none"' : ""}>
            <button onClick="sayDescription(this); false">Description</button>
          </td>
          <td class="word">${(typeof wordlist[i] === 'string') ? wordlist[i] : wordlist[i].word}</td>
          <td>
            <input type="text" onkeypress="keypress(this)" autocomplete="off" autocorrect="off" autocapitalize="off" 
            spellcheck="false" /> 
            <button onClick="checkWord(this)">Check</button>
          </td></tr>`;
        let obj = table.insertAdjacentHTML("beforeend",row);
      }
      
      setTimeout(() => {
        const input = table.querySelector('input');
        input.focus();
      }, "300");
    }

    window.onload = function() {
      buildPrompts();
    }
    
</script>
<div>
  <input type="radio" id="avk" name="kid" value="avk" onclick="toggleKid(this)" checked>
  <label for="avk" onclick="toggleKid(this)">AvK</label>
  <input type="radio" id="vvk" name="kid" value="vvk" onclick="toggleKid(this)" onclick="toggleKid(this)">
  <label for="vvk">VvK</label><br>
</div>
<div id="prompts">
  <table><tbody></tbody></table>
  
  <div><button onclick="tryAgain()">Try Again</button></div>
  <div><a href="math.html">Multiplication</a></div>
  <div><a href="map.html">Map</a></div>
  </body>
</html>